<p align="center">
  <img src="https://github.com/7290903/addon-repository/blob/main/envoy-mqtt/logo.png" alt="Envoy MQTT Failover by RunHouse" width="120" />
</p>

# Envoy MQTT Failover

**TCP-—Ñ–µ–π–ª–æ–≤–µ—Ä –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ MQTT-–±—Ä–æ–∫–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ Envoy Proxy**

–≠—Ç–æ—Ç Home Assistant Add-on –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å MQTT-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Envoy Proxy –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ.

---

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ù–∞–¥—ë–∂–Ω—ã–π TCP-—Ñ–µ–π–ª–æ–≤–µ—Ä –¥–ª—è MQTT
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ—Ä—Ç–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `/config/envoy_mqtt.yaml`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä: `amd64`, `armv7`, `armhf`, `aarch64`

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `/config/envoy_mqtt.yaml`:

```yaml
port: 1885
brokers:
  - 192.168.2.48
  - 192.168.2.33
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Home Assistant –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–æ–∫—Å–∏:

```yaml
mqtt:
  broker: 127.0.0.1
  port: 1885
```

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ `envoy_mqtt.yaml`.

---

## üêã Docker –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑: `envoyproxy/envoy:v1.29-latest`
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `run.sh`, –∫–æ—Ç–æ—Ä—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `envoy.yaml`
- –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `stdout`, Envoy –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `--log-level info`

---

## üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `port` ‚Äî –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º Envoy —Å–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MQTT
- `brokers` ‚Äî –°–ø–∏—Å–æ–∫ IP MQTT-–±—Ä–æ–∫–µ—Ä–æ–≤ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç–∏)

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

- `docker logs <container>` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞
- `/tmp/envoy.yaml` ‚Äî –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Admin API Envoy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `http://localhost:9901`

---

## üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `/config/envoy_mqtt.yaml`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã –∏ –±—Ä–æ–∫–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ `run.sh` –∏ Envoy

---

**–ê–≤—Ç–æ—Ä**: [RunHouse Project]
